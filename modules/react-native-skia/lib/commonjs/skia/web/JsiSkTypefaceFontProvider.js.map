{"version":3,"names":["JsiSkTypefaceFontProvider","HostObject","constructor","CanvasKit","ref","matchFamilyStyle","_name","_style","NotImplementedOnRNWeb","countFamilies","getFamilyName","index","registerFont","typeface","familyName","strLen","lengthBytesUTF8","strPtr","_malloc","stringToUTF8","_registerFont","dispose","ptr","allocatedPointers","_free","delete","str","encoder","TextEncoder","utf8","encode","length","outPtr","maxBytesToWrite","heap","HEAPU8","Error","i"],"sources":["JsiSkTypefaceFontProvider.ts"],"sourcesContent":["import type { CanvasKit, TypefaceFontProvider } from \"canvaskit-wasm\";\n\nimport type { SkTypefaceFontProvider } from \"../types/Paragraph/TypefaceFontProvider\";\nimport type { FontStyle, SkTypeface } from \"../types\";\n\nimport { HostObject, NotImplementedOnRNWeb } from \"./Host\";\n\nexport class JsiSkTypefaceFontProvider\n  extends HostObject<TypefaceFontProvider, \"FontMgr\">\n  implements SkTypefaceFontProvider\n{\n  private allocatedPointers: number[] = [];\n\n  constructor(CanvasKit: CanvasKit, ref: TypefaceFontProvider) {\n    super(CanvasKit, ref, \"FontMgr\");\n  }\n\n  matchFamilyStyle(_name: string, _style: FontStyle): SkTypeface {\n    throw new NotImplementedOnRNWeb();\n  }\n  countFamilies() {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    return this.ref.countFamilies();\n  }\n  getFamilyName(index: number) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    return this.ref.getFamilyName(index);\n  }\n  registerFont(typeface: SkTypeface, familyName: string) {\n    const strLen = lengthBytesUTF8(familyName) + 1;\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    const strPtr = this.CanvasKit._malloc(strLen);\n    stringToUTF8(this.CanvasKit, familyName, strPtr, strLen);\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    this.ref._registerFont(typeface.ref, strPtr);\n  }\n\n  dispose() {\n    for (const ptr of this.allocatedPointers) {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-expect-error\n      this.CanvasKit._free(ptr);\n    }\n\n    this.ref.delete();\n  }\n}\n\nconst lengthBytesUTF8 = (str: string) => {\n  // TextEncoder will give us the byte length in UTF8 form\n  const encoder = new TextEncoder();\n  const utf8 = encoder.encode(str);\n  return utf8.length;\n};\n\nconst stringToUTF8 = (\n  CanvasKit: CanvasKit,\n  str: string,\n  outPtr: number,\n  maxBytesToWrite: number\n) => {\n  // TextEncoder will give us the byte array in UTF8 form\n  const encoder = new TextEncoder();\n  const utf8 = encoder.encode(str);\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-expect-error\n  const heap: Int8Array = CanvasKit.HEAPU8;\n\n  // Check if there's enough space\n  if (utf8.length > maxBytesToWrite) {\n    throw new Error(\"Not enough space to write UTF8 encoded string\");\n  }\n\n  // Copy the bytes\n  for (let i = 0; i < utf8.length; i++) {\n    heap[outPtr + i] = utf8[i];\n  }\n\n  // Null terminate\n  if (utf8.length < maxBytesToWrite) {\n    heap[outPtr + utf8.length] = 0;\n  }\n};\n"],"mappings":";;;;;;;AAKA;;;;AAEO,MAAMA,yBAAN,SACGC,gBADH,CAGP;EAGEC,WAAW,CAACC,SAAD,EAAuBC,GAAvB,EAAkD;IAC3D,MAAMD,SAAN,EAAiBC,GAAjB,EAAsB,SAAtB;;IAD2D,2CAFvB,EAEuB;EAE5D;;EAEDC,gBAAgB,CAACC,KAAD,EAAgBC,MAAhB,EAA+C;IAC7D,MAAM,IAAIC,2BAAJ,EAAN;EACD;;EACDC,aAAa,GAAG;IACd;IACA;IACA,OAAO,KAAKL,GAAL,CAASK,aAAT,EAAP;EACD;;EACDC,aAAa,CAACC,KAAD,EAAgB;IAC3B;IACA;IACA,OAAO,KAAKP,GAAL,CAASM,aAAT,CAAuBC,KAAvB,CAAP;EACD;;EACDC,YAAY,CAACC,QAAD,EAAuBC,UAAvB,EAA2C;IACrD,MAAMC,MAAM,GAAGC,eAAe,CAACF,UAAD,CAAf,GAA8B,CAA7C,CADqD,CAGrD;IACA;;IACA,MAAMG,MAAM,GAAG,KAAKd,SAAL,CAAee,OAAf,CAAuBH,MAAvB,CAAf;;IACAI,YAAY,CAAC,KAAKhB,SAAN,EAAiBW,UAAjB,EAA6BG,MAA7B,EAAqCF,MAArC,CAAZ,CANqD,CAQrD;IACA;;IACA,KAAKX,GAAL,CAASgB,aAAT,CAAuBP,QAAQ,CAACT,GAAhC,EAAqCa,MAArC;EACD;;EAEDI,OAAO,GAAG;IACR,KAAK,MAAMC,GAAX,IAAkB,KAAKC,iBAAvB,EAA0C;MACxC;MACA;MACA,KAAKpB,SAAL,CAAeqB,KAAf,CAAqBF,GAArB;IACD;;IAED,KAAKlB,GAAL,CAASqB,MAAT;EACD;;AAzCH;;;;AA4CA,MAAMT,eAAe,GAAIU,GAAD,IAAiB;EACvC;EACA,MAAMC,OAAO,GAAG,IAAIC,WAAJ,EAAhB;EACA,MAAMC,IAAI,GAAGF,OAAO,CAACG,MAAR,CAAeJ,GAAf,CAAb;EACA,OAAOG,IAAI,CAACE,MAAZ;AACD,CALD;;AAOA,MAAMZ,YAAY,GAAG,CACnBhB,SADmB,EAEnBuB,GAFmB,EAGnBM,MAHmB,EAInBC,eAJmB,KAKhB;EACH;EACA,MAAMN,OAAO,GAAG,IAAIC,WAAJ,EAAhB;EACA,MAAMC,IAAI,GAAGF,OAAO,CAACG,MAAR,CAAeJ,GAAf,CAAb,CAHG,CAIH;EACA;;EACA,MAAMQ,IAAe,GAAG/B,SAAS,CAACgC,MAAlC,CANG,CAQH;;EACA,IAAIN,IAAI,CAACE,MAAL,GAAcE,eAAlB,EAAmC;IACjC,MAAM,IAAIG,KAAJ,CAAU,+CAAV,CAAN;EACD,CAXE,CAaH;;;EACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,IAAI,CAACE,MAAzB,EAAiCM,CAAC,EAAlC,EAAsC;IACpCH,IAAI,CAACF,MAAM,GAAGK,CAAV,CAAJ,GAAmBR,IAAI,CAACQ,CAAD,CAAvB;EACD,CAhBE,CAkBH;;;EACA,IAAIR,IAAI,CAACE,MAAL,GAAcE,eAAlB,EAAmC;IACjCC,IAAI,CAACF,MAAM,GAAGH,IAAI,CAACE,MAAf,CAAJ,GAA6B,CAA7B;EACD;AACF,CA3BD"}